<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity Feed & Smart Reminders - STACKED CRM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #1a1d29;
            color: #ffffff;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: #2a2d3a;
            padding: 20px 0;
            border-right: 1px solid #3a3d4a;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .logo {
            display: flex;
            align-items: center;
            padding: 0 20px;
            margin-bottom: 30px;
        }

        .logo-icon {
            width: 28px;
            height: 28px;
            background-color: #ffffff;
            border-radius: 4px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #1a1d29;
            font-size: 14px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 600;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #8b8d98;
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background-color: #3a3d4a;
            color: #ffffff;
        }

        .nav-item.active {
            background-color: #3a3d4a;
            color: #4ecdc4;
            border-left-color: #4ecdc4;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
        }

        .upgrade-section {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
        }

        .upgrade-card {
            background-color: #3a3d4a;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .upgrade-btn {
            background-color: #4ecdc4;
            color: #1a1d29;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            width: 100%;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            background-color: #1a1d29;
        }

        .content-wrapper {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header Section */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #3a3d4a;
        }

        .header-left {
            flex: 1;
        }

        .page-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: #8b8d98;
            font-size: 16px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .action-button {
            background-color: #4ecdc4;
            color: #1a1d29;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .action-button.secondary {
            background-color: transparent;
            color: #4ecdc4;
            border: 1px solid #4ecdc4;
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: #2a2d3a;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #3a3d4a;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 600;
            color: #4ecdc4;
            margin-bottom: 4px;
        }

        .stat-label {
            color: #8b8d98;
            font-size: 14px;
        }

        /* Tabs */
        .tab-container {
            margin-bottom: 30px;
        }

        .tab-list {
            display: flex;
            border-bottom: 1px solid #3a3d4a;
            margin-bottom: 20px;
        }

        .tab-button {
            background: none;
            border: none;
            color: #8b8d98;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .tab-button.active {
            color: #4ecdc4;
            border-bottom-color: #4ecdc4;
        }

        .tab-button:hover:not(.active) {
            color: #ffffff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Enhanced Filter Bar */
        .filter-section {
            background-color: #2a2d3a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #3a3d4a;
        }

        .filter-row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 150px;
        }

        .filter-label {
            color: #8b8d98;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .filter-select {
            background-color: #3a3d4a;
            border: 1px solid #4a4d5a;
            color: #ffffff;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 14px;
        }

        .search-group {
            flex: 1;
            min-width: 250px;
        }

        .search-box {
            background-color: #3a3d4a;
            border: 1px solid #4a4d5a;
            color: #ffffff;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 14px;
            width: 100%;
        }

        /* Smart Reminders - Organized by Priority */
        .reminders-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .priority-column {
            background-color: #2a2d3a;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #3a3d4a;
        }

        .priority-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #3a3d4a;
        }

        .priority-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .priority-icon.high {
            background-color: #ff6b6b;
        }

        .priority-icon.medium {
            background-color: #ffa500;
        }

        .priority-icon.low {
            background-color: #4ecdc4;
        }

        .priority-title {
            font-size: 16px;
            font-weight: 600;
        }

        .reminder-count {
            background-color: #3a3d4a;
            color: #8b8d98;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-left: auto;
        }

        .reminder-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .reminder-item {
            background-color: #3a3d4a;
            border-radius: 8px;
            padding: 16px;
            border-left: 3px solid transparent;
        }

        .reminder-item.high {
            border-left-color: #ff6b6b;
        }

        .reminder-item.medium {
            border-left-color: #ffa500;
        }

        .reminder-item.low {
            border-left-color: #4ecdc4;
        }

        .reminder-client {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 6px;
            color: #4ecdc4;
        }

        .reminder-text {
            color: #ffffff;
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .reminder-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .reminder-time {
            color: #8b8d98;
            font-size: 11px;
        }

        .reminder-property {
            color: #ff9800;
            font-size: 11px;
        }

        .reminder-actions {
            display: flex;
            gap: 8px;
        }

        .reminder-btn {
            padding: 6px 12px;
            border-radius: 4px;
            border: none;
            font-size: 11px;
            cursor: pointer;
            font-weight: 500;
            flex: 1;
        }

        .reminder-btn.primary {
            background-color: #4ecdc4;
            color: #1a1d29;
        }

        .reminder-btn.secondary {
            background-color: transparent;
            color: #8b8d98;
            border: 1px solid #4a4d5a;
        }

        /* Activity Feed - Clean Timeline */
        .activity-container {
            background-color: #2a2d3a;
            border-radius: 12px;
            padding: 24px;
            border: 1px solid #3a3d4a;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #3a3d4a;
        }

        .activity-title {
            font-size: 18px;
            font-weight: 600;
        }

        .activity-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .view-toggle {
            display: flex;
            background-color: #3a3d4a;
            border-radius: 6px;
            padding: 2px;
        }

        .view-btn {
            background: none;
            border: none;
            color: #8b8d98;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .view-btn.active {
            background-color: #4ecdc4;
            color: #1a1d29;
        }

        .activity-timeline {
            position: relative;
        }

        .timeline-line {
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #3a3d4a;
        }

        .activity-entry {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            position: relative;
        }

        .activity-entry:last-child {
            margin-bottom: 0;
        }

        .activity-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
            z-index: 1;
            border: 3px solid #2a2d3a;
        }

        .activity-dot.call {
            background-color: #4ecdc4;
            color: #1a1d29;
        }

        .activity-dot.email {
            background-color: #42a5f5;
            color: #ffffff;
        }

        .activity-dot.meeting {
            background-color: #9c27b0;
            color: #ffffff;
        }

        .activity-dot.property {
            background-color: #ff9800;
            color: #ffffff;
        }

        .activity-dot.note {
            background-color: #7986cb;
            color: #ffffff;
        }

        .activity-card {
            flex: 1;
            background-color: #3a3d4a;
            border-radius: 8px;
            padding: 16px;
        }

        .activity-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 8px;
        }

        .activity-type {
            font-weight: 600;
            font-size: 14px;
        }

        .activity-time {
            color: #8b8d98;
            font-size: 12px;
        }

        .activity-description {
            color: #ffffff;
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .activity-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-client-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .client-name {
            color: #4ecdc4;
            font-size: 12px;
            font-weight: 500;
        }

        .property-info {
            color: #ff9800;
            font-size: 12px;
        }

        .activity-tags {
            display: flex;
            gap: 6px;
        }

        .activity-tag {
            background-color: rgba(76, 205, 196, 0.2);
            color: #4ecdc4;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 500;
        }

        .activity-tag.urgent {
            background-color: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        .activity-tag.showing {
            background-color: rgba(156, 39, 176, 0.2);
            color: #9c27b0;
        }

        .activity-tag.lead {
            background-color: rgba(255, 152, 0, 0.2);
            color: #ff9800;
        }

        /* Priority Info Section */
        .priority-info-section {
            background-color: #2a2d3a;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #3a3d4a;
        }

        .info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .info-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: #4ecdc4;
        }

        .info-toggle {
            background: none;
            border: 1px solid #4a4d5a;
            color: #8b8d98;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-toggle:hover {
            border-color: #4ecdc4;
            color: #4ecdc4;
        }

        .priority-details {
            border-top: 1px solid #3a3d4a;
            padding-top: 16px;
        }

        .priority-scoring {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .scoring-column h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .scoring-column ul {
            list-style: none;
            padding: 0;
        }

        .scoring-column li {
            padding: 6px 0;
            font-size: 12px;
            color: #8b8d98;
            border-bottom: 1px solid rgba(58, 61, 74, 0.5);
        }

        .scoring-column li:last-child {
            border-bottom: none;
        }

        .scoring-column strong {
            color: #ffffff;
        }

        .priority-multipliers {
            background-color: #3a3d4a;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .priority-multipliers h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #ffa500;
        }

        .multiplier-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
        }

        .multiplier-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 12px;
        }

        .multiplier-label {
            color: #8b8d98;
        }

        .multiplier-value {
            color: #ffa500;
            font-weight: 600;
        }

        .priority-examples {
            background-color: #3a3d4a;
            border-radius: 8px;
            padding: 16px;
        }

        .priority-examples h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #4ecdc4;
        }

        .example-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .example-item {
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid;
        }

        .example-item.high {
            background-color: rgba(255, 107, 107, 0.1);
            border-left-color: #ff6b6b;
        }

        .example-item.medium {
            background-color: rgba(255, 165, 0, 0.1);
            border-left-color: #ffa500;
        }

        .example-item.low {
            background-color: rgba(76, 205, 196, 0.1);
            border-left-color: #4ecdc4;
        }

        .example-item strong {
            font-size: 12px;
            display: block;
            margin-bottom: 4px;
        }

        .example-item p {
            font-size: 11px;
            color: #8b8d98;
            margin: 0;
        }

        /* Priority Score Display */
        .priority-score {
            background-color: rgba(76, 205, 196, 0.2);
            color: #4ecdc4;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 8px;
        }

        .reminder-scoring {
            margin-bottom: 8px;
        }

        .score-detail {
            font-size: 10px;
            color: #8b8d98;
            font-style: italic;
        }
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #8b8d98;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .reminders-container {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
            }
            
            .sidebar {
                display: none;
            }
            
            .reminders-container {
                grid-template-columns: 1fr;
            }
            
            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .page-header {
                flex-direction: column;
                align-items: stretch;
                gap: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <div class="logo-icon">‚â°</div>
            <div class="logo-text">STACKED</div>
        </div>
        
        <nav>
            <a href="#" class="nav-item">
                <span class="nav-icon">üìä</span>
                Dashboard
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">üë•</span>
                Clients
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">üè†</span>
                Properties
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">üìÖ</span>
                Calendar
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">üìÑ</span>
                Documents
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">üìö</span>
                Library
            </a>
            <a href="#" class="nav-item active">
                <span class="nav-icon">üìà</span>
                Analytics
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">üí∞</span>
                Pricing
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">‚öôÔ∏è</span>
                Settings
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">‚ÜóÔ∏è</span>
                Logout
            </a>
        </nav>

        <div class="upgrade-section">
            <div class="upgrade-card">
                <div style="font-size: 14px; font-weight: 600; margin-bottom: 4px;">Upgrade</div>
                <div style="font-size: 12px; color: #8b8d98; margin-bottom: 8px;">Unlock advanced features</div>
                <button class="upgrade-btn">Upgrade Now</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="content-wrapper">
            <!-- Header -->
            <div class="page-header">
                <div class="header-left">
                    <h1 class="page-title">Activity Hub</h1>
                    <p class="page-subtitle">Stay on top of client interactions and never miss a follow-up</p>
                </div>
                <div class="header-actions">
                    <button class="action-button secondary">
                        ‚öôÔ∏è Settings
                    </button>
                    <button class="action-button">
                        ‚ûï Add Activity
                    </button>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="quick-stats">
                <div class="stat-card">
                    <div class="stat-number">12</div>
                    <div class="stat-label">Pending Reminders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">47</div>
                    <div class="stat-label">Today's Activities</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">3</div>
                    <div class="stat-label">Urgent Follow-ups</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">89%</div>
                    <div class="stat-label">Response Rate</div>
                </div>
            </div>

            <!-- Tabs -->
            <!-- Priority Scoring Info -->
            <div class="priority-info-section">
                <div class="info-header">
                    <h3>üìä How Priority is Calculated</h3>
                    <div class="header-buttons">
                        <button class="info-toggle" onclick="toggleDeveloperGuide()">
                            <span id="dev-toggle-text">Developer Guide</span> <span id="dev-toggle-icon">üë®‚Äçüíª</span>
                        </button>
                        <button class="info-toggle" onclick="togglePriorityInfo()">
                            <span id="toggle-text">Show Details</span> <span id="toggle-icon">‚ñº</span>
                        </button>
                    </div>
                </div>

                <!-- Developer Implementation Guide -->
                <div class="developer-guide" id="developer-guide" style="display: none;">
                    <div class="dev-section">
                        <h4>üîß Database Schema Setup</h4>
                        <div class="code-block">
<pre><code>-- Reminders Table
CREATE TABLE smart_reminders (
    id UUID PRIMARY KEY,
    client_id UUID REFERENCES clients(id),
    property_id UUID REFERENCES properties(id),
    reminder_type VARCHAR(50) NOT NULL,
    base_score INTEGER NOT NULL,
    multiplier_score DECIMAL(3,2) DEFAULT 1.0,
    final_score INTEGER GENERATED ALWAYS AS (base_score * multiplier_score) STORED,
    priority_level VARCHAR(10) GENERATED ALWAYS AS (
        CASE 
            WHEN final_score >= 80 THEN 'high'
            WHEN final_score >= 40 THEN 'medium'
            ELSE 'low'
        END
    ) STORED,
    created_at TIMESTAMP DEFAULT NOW(),
    due_date TIMESTAMP,
    is_completed BOOLEAN DEFAULT FALSE
);

-- Client Metadata for Multipliers
ALTER TABLE clients ADD COLUMN client_type VARCHAR(20) DEFAULT 'standard';
ALTER TABLE clients ADD COLUMN is_referral_source BOOLEAN DEFAULT FALSE;
ALTER TABLE clients ADD COLUMN is_repeat_client BOOLEAN DEFAULT FALSE;

-- Properties for Value-based Multipliers
ALTER TABLE properties ADD COLUMN listing_price DECIMAL(12,2);</code></pre>
                        </div>
                    </div>

                    <div class="dev-section">
                        <h4>‚öôÔ∏è Priority Calculation Engine (JavaScript/Node.js)</h4>
                        <div class="code-block">
<pre><code>class PriorityCalculator {
    static SCORING_RULES = {
        NO_CONTACT_10_PLUS: 30,
        NO_CONTACT_5_TO_9: 15,
        HOT_LEAD: 25,
        PRE_APPROVAL_EXPIRING: 35,
        CONTRACT_DEADLINE: 40,
        MISSED_APPOINTMENT: 30,
        SHOWING_FOLLOWUP: 20,
        DOCUMENT_PENDING: 15,
        MARKET_UPDATE: 10,
        SCHEDULING_NEEDED: 15,
        BIRTHDAY_ANNIVERSARY: 10,
        REGULAR_CHECKIN: 5,
        NEWSLETTER: 5,
        REFERRAL_OPPORTUNITY: 12
    };

    static MULTIPLIERS = {
        VIP_CLIENT: 1.5,
        REFERRAL_SOURCE: 1.3,
        HIGH_VALUE_PROPERTY: 1.4, // >$500K
        REPEAT_CLIENT: 1.2
    };

    static calculatePriority(reminderData) {
        let baseScore = 0;
        let multiplier = 1.0;

        // Calculate base score
        baseScore += this.getContactScore(reminderData.lastContactDays);
        baseScore += this.getLeadScore(reminderData.leadActivity);
        baseScore += this.getUrgencyScore(reminderData.urgencyFactors);
        baseScore += this.getActivityScore(reminderData.activityType);

        // Calculate multipliers
        multiplier *= this.getClientMultiplier(reminderData.client);
        multiplier *= this.getPropertyMultiplier(reminderData.property);

        const finalScore = Math.round(baseScore * multiplier);
        
        return {
            baseScore,
            multiplier,
            finalScore,
            priority: this.getPriorityLevel(finalScore),
            breakdown: this.getScoreBreakdown(reminderData, baseScore, multiplier)
        };
    }

    static getContactScore(daysSinceContact) {
        if (daysSinceContact >= 10) return this.SCORING_RULES.NO_CONTACT_10_PLUS;
        if (daysSinceContact >= 5) return this.SCORING_RULES.NO_CONTACT_5_TO_9;
        return 0;
    }

    static getLeadScore(leadActivity) {
        if (leadActivity.propertiesViewed >= 3) return this.SCORING_RULES.HOT_LEAD;
        return 0;
    }

    static getUrgencyScore(urgencyFactors) {
        let score = 0;
        if (urgencyFactors.preApprovalExpiring) score += this.SCORING_RULES.PRE_APPROVAL_EXPIRING;
        if (urgencyFactors.contractDeadline) score += this.SCORING_RULES.CONTRACT_DEADLINE;
        if (urgencyFactors.missedAppointment) score += this.SCORING_RULES.MISSED_APPOINTMENT;
        return score;
    }

    static getActivityScore(activityType) {
        return this.SCORING_RULES[activityType] || 0;
    }

    static getClientMultiplier(client) {
        let multiplier = 1.0;
        if (client.type === 'vip') multiplier *= this.MULTIPLIERS.VIP_CLIENT;
        if (client.isReferralSource) multiplier *= this.MULTIPLIERS.REFERRAL_SOURCE;
        if (client.isRepeatClient) multiplier *= this.MULTIPLIERS.REPEAT_CLIENT;
        return multiplier;
    }

    static getPropertyMultiplier(property) {
        if (property && property.price > 500000) {
            return this.MULTIPLIERS.HIGH_VALUE_PROPERTY;
        }
        return 1.0;
    }

    static getPriorityLevel(score) {
        if (score >= 80) return 'high';
        if (score >= 40) return 'medium';
        return 'low';
    }
}</code></pre>
                        </div>
                    </div>

                    <div class="dev-section">
                        <h4>üîÑ Automated Reminder Generation</h4>
                        <div class="code-block">
<pre><code>// Cron job to generate reminders (runs daily)
class ReminderGenerator {
    static async generateDailyReminders() {
        const clients = await this.getActiveClients();
        
        for (const client of clients) {
            await this.checkContactReminders(client);
            await this.checkPreApprovalReminders(client);
            await this.checkContractReminders(client);
            await this.checkBirthdayReminders(client);
            await this.checkFollowupReminders(client);
        }
    }

    static async checkContactReminders(client) {
        const lastContact = await this.getLastContactDate(client.id);
        const daysSince = this.daysBetween(lastContact, new Date());
        
        if (daysSince >= 5) {
            const leadActivity = await this.getLeadActivity(client.id);
            const urgencyFactors = await this.getUrgencyFactors(client.id);
            
            const reminderData = {
                client,
                lastContactDays: daysSince,
                leadActivity,
                urgencyFactors,
                activityType: daysSince >= 10 ? 'NO_CONTACT_10_PLUS' : 'NO_CONTACT_5_TO_9'
            };

            const priority = PriorityCalculator.calculatePriority(reminderData);
            
            await this.createReminder({
                clientId: client.id,
                type: 'no_contact',
                message: `No contact in ${daysSince} days`,
                baseScore: priority.baseScore,
                multiplierScore: priority.multiplier,
                scoreBreakdown: priority.breakdown,
                dueDate: new Date()
            });
        }
    }

    static async checkPreApprovalReminders(client) {
        const preApproval = await this.getPreApprovalStatus(client.id);
        
        if (preApproval && preApproval.expiresInDays <= 7) {
            const reminderData = {
                client,
                urgencyFactors: { preApprovalExpiring: true },
                activityType: 'PRE_APPROVAL_EXPIRING'
            };

            const priority = PriorityCalculator.calculatePriority(reminderData);
            
            await this.createReminder({
                clientId: client.id,
                type: 'pre_approval_expiring',
                message: `Pre-approval expires in ${preApproval.expiresInDays} days`,
                baseScore: priority.baseScore,
                multiplierScore: priority.multiplier,
                dueDate: preApproval.expirationDate
            });
        }
    }
}</code></pre>
                        </div>
                    </div>

                    <div class="dev-section">
                        <h4>üìä API Endpoints</h4>
                        <div class="code-block">
<pre><code>// GET /api/reminders - Fetch prioritized reminders
app.get('/api/reminders', async (req, res) => {
    const { priority, clientId, limit = 50 } = req.query;
    
    const query = `
        SELECT r.*, c.name as client_name, c.client_type,
               p.address as property_address, p.listing_price
        FROM smart_reminders r
        JOIN clients c ON r.client_id = c.id
        LEFT JOIN properties p ON r.property_id = p.id
        WHERE r.is_completed = false
        ${priority ? `AND r.priority_level = $1` : ''}
        ORDER BY r.final_score DESC, r.created_at ASC
        LIMIT ${priority ? 2 : 1}
    `;
    
    const reminders = await db.query(query, priority ? [priority, limit] : [limit]);
    res.json(reminders.rows);
});

// POST /api/reminders/recalculate - Recalculate all priorities
app.post('/api/reminders/recalculate', async (req, res) => {
    const reminders = await db.query('SELECT * FROM smart_reminders WHERE is_completed = false');
    
    for (const reminder of reminders.rows) {
        const client = await this.getClientData(reminder.client_id);
        const property = await this.getPropertyData(reminder.property_id);
        
        const reminderData = {
            client,
            property,
            // ... rebuild reminder data
        };
        
        const priority = PriorityCalculator.calculatePriority(reminderData);
        
        await db.query(
            'UPDATE smart_reminders SET base_score = $1, multiplier_score = $2 WHERE id = $3',
            [priority.baseScore, priority.multiplier, reminder.id]
        );
    }
    
    res.json({ message: 'Priorities recalculated successfully' });
});</code></pre>
                        </div>
                    </div>

                    <div class="dev-section">
                        <h4>üéØ Frontend Integration</h4>
                        <div class="code-block">
<pre><code>// React component for displaying reminders
const ReminderCard = ({ reminder }) => {
    const getPriorityColor = (priority) => {
        const colors = {
            high: '#ff6b6b',
            medium: '#ffa500',
            low: '#4ecdc4'
        };
        return colors[priority] || '#8b8d98';
    };

    return (
        &lt;div className={`reminder-item ${reminder.priority_level}`}&gt;
            &lt;div className="reminder-client"&gt;
                {reminder.client_name}
                &lt;span className="priority-score"&gt;{reminder.final_score} pts&lt;/span&gt;
            &lt;/div&gt;
            &lt;div className="reminder-text"&gt;{reminder.message}&lt;/div&gt;
            &lt;div className="reminder-scoring"&gt;
                &lt;span className="score-detail"&gt;{reminder.score_breakdown}&lt;/span&gt;
            &lt;/div&gt;
            {/* ... rest of component */}
        &lt;/div&gt;
    );
};

// Fetch and update reminders
const useReminders = () => {
    const [reminders, setReminders] = useState([]);
    
    const fetchReminders = async (priority = null) => {
        const response = await fetch(`/api/reminders${priority ? `?priority=${priority}` : ''}`);
        const data = await response.json();
        setReminders(data);
    };
    
    useEffect(() => {
        fetchReminders();
        // Refresh every 5 minutes
        const interval = setInterval(fetchReminders, 5 * 60 * 1000);
        return () => clearInterval(interval);
    }, []);
    
    return { reminders, fetchReminders };
};</code></pre>
                        </div>
                    </div>

                    <div class="dev-section">
                        <h4>‚ö° Performance Optimization</h4>
                        <div class="code-block">
<pre><code>-- Database Indexes for Performance
CREATE INDEX idx_reminders_priority_score ON smart_reminders(final_score DESC, created_at);
CREATE INDEX idx_reminders_client_priority ON smart_reminders(client_id, priority_level);
CREATE INDEX idx_reminders_due_date ON smart_reminders(due_date) WHERE is_completed = false;

-- Materialized View for Dashboard Stats
CREATE MATERIALIZED VIEW reminder_stats AS
SELECT 
    priority_level,
    COUNT(*) as count,
    AVG(final_score) as avg_score
FROM smart_reminders 
WHERE is_completed = false 
GROUP BY priority_level;

-- Refresh stats view (run hourly)
REFRESH MATERIALIZED VIEW reminder_stats;</code></pre>
                        </div>
                    </div>

                    <div class="dev-section">
                        <h4>üß™ Testing Examples</h4>
                        <div class="code-block">
<pre><code>// Unit tests for priority calculation
describe('PriorityCalculator', () => {
    test('calculates high priority for VIP client with no contact', () => {
        const reminderData = {
            client: { type: 'vip', isReferralSource: false, isRepeatClient: false },
            property: { price: 450000 },
            lastContactDays: 14,
            leadActivity: { propertiesViewed: 3 },
            urgencyFactors: {},
            activityType: 'NO_CONTACT_10_PLUS'
        };
        
        const result = PriorityCalculator.calculatePriority(reminderData);
        
        expect(result.baseScore).toBe(55); // 30 + 25
        expect(result.multiplier).toBe(1.5); // VIP multiplier
        expect(result.finalScore).toBe(83); // 55 * 1.5
        expect(result.priority).toBe('high');
    });
    
    test('handles low priority birthday reminder', () => {
        const reminderData = {
            client: { type: 'standard', isReferralSource: false, isRepeatClient: false },
            property: null,
            lastContactDays: 2,
            leadActivity: { propertiesViewed: 0 },
            urgencyFactors: {},
            activityType: 'BIRTHDAY_ANNIVERSARY'
        };
        
        const result = PriorityCalculator.calculatePriority(reminderData);
        
        expect(result.finalScore).toBe(10);
        expect(result.priority).toBe('low');
    });
});</code></pre>
                        </div>
                    </div>
                </div>
                <div class="priority-details" id="priority-details" style="display: none;">
                    <div class="priority-scoring">
                        <div class="scoring-column">
                            <h4>üî¥ High Priority (80-100 points)</h4>
                            <ul>
                                <li><strong>No contact 10+ days:</strong> +30 points</li>
                                <li><strong>Hot lead (viewed 3+ properties):</strong> +25 points</li>
                                <li><strong>Pre-approval expiring (‚â§7 days):</strong> +35 points</li>
                                <li><strong>Under contract with deadline:</strong> +40 points</li>
                                <li><strong>Missed appointment follow-up:</strong> +30 points</li>
                                <li><strong>Price reduction consideration:</strong> +20 points</li>
                            </ul>
                        </div>
                        <div class="scoring-column">
                            <h4>üü° Medium Priority (40-79 points)</h4>
                            <ul>
                                <li><strong>No contact 5-9 days:</strong> +15 points</li>
                                <li><strong>Showing follow-up needed:</strong> +20 points</li>
                                <li><strong>Document pending:</strong> +15 points</li>
                                <li><strong>Market update requested:</strong> +10 points</li>
                                <li><strong>Scheduling needed:</strong> +15 points</li>
                                <li><strong>Warm lead engagement:</strong> +10 points</li>
                            </ul>
                        </div>
                        <div class="scoring-column">
                            <h4>üü¢ Low Priority (10-39 points)</h4>
                            <ul>
                                <li><strong>Regular check-in:</strong> +5 points</li>
                                <li><strong>Newsletter/marketing:</strong> +5 points</li>
                                <li><strong>Birthday/anniversary:</strong> +10 points</li>
                                <li><strong>General follow-up:</strong> +5 points</li>
                                <li><strong>Past client touch-base:</strong> +8 points</li>
                                <li><strong>Referral opportunity:</strong> +12 points</li>
                            </ul>
                        </div>
                    </div>
                    <div class="priority-multipliers">
                        <h4>‚ö° Priority Multipliers</h4>
                        <div class="multiplier-grid">
                            <div class="multiplier-item">
                                <span class="multiplier-label">VIP Client:</span>
                                <span class="multiplier-value">√ó1.5</span>
                            </div>
                            <div class="multiplier-item">
                                <span class="multiplier-label">Referral Source:</span>
                                <span class="multiplier-value">√ó1.3</span>
                            </div>
                            <div class="multiplier-item">
                                <span class="multiplier-label">High-Value Property (>$500K):</span>
                                <span class="multiplier-value">√ó1.4</span>
                            </div>
                            <div class="multiplier-item">
                                <span class="multiplier-label">Repeat Client:</span>
                                <span class="multiplier-value">√ó1.2</span>
                            </div>
                        </div>
                    </div>
                    <div class="priority-examples">
                        <h4>üí° Examples</h4>
                        <div class="example-grid">
                            <div class="example-item high">
                                <strong>Sarah Johnson - 91 points (High)</strong>
                                <p>No contact 14 days (30) + Hot lead (25) + High-value property (√ó1.4) = 91 points</p>
                            </div>
                            <div class="example-item medium">
                                <strong>Mike & Lisa Chen - 52 points (Medium)</strong>
                                <p>Showing follow-up (20) + Document pending (15) + VIP client (√ó1.5) = 52 points</p>
                            </div>
                            <div class="example-item low">
                                <strong>Maria Rodriguez - 22 points (Low)</strong>
                                <p>Birthday follow-up (10) + Referral opportunity (12) = 22 points</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-container">
                <div class="tab-list">
                    <button class="tab-button active" data-tab="reminders">Smart Reminders</button>
                    <button class="tab-button" data-tab="activity">Activity Feed</button>
                    <button class="tab-button" data-tab="insights">Insights</button>
                </div>

                <!-- Smart Reminders Tab -->
                <div class="tab-content active" id="reminders">
                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label class="filter-label">Priority</label>
                                <select class="filter-select">
                                    <option>All Priorities</option>
                                    <option>High Priority</option>
                                    <option>Medium Priority</option>
                                    <option>Low Priority</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Type</label>
                                <select class="filter-select">
                                    <option>All Types</option>
                                    <option>No Contact</option>
                                    <option>Follow-up</option>
                                    <option>Documents</option>
                                    <option>Appointments</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Client Status</label>
                                <select class="filter-select">
                                    <option>All Clients</option>
                                    <option>Active Leads</option>
                                    <option>Hot Prospects</option>
                                    <option>Past Clients</option>
                                </select>
                            </div>
                            <div class="search-group">
                                <label class="filter-label">Search</label>
                                <input type="text" class="search-box" placeholder="Search by client name or property...">
                            </div>
                        </div>
                    </div>

                    <div class="reminders-container">
                        <!-- High Priority -->
                        <div class="priority-column">
                            <div class="priority-header">
                                <div class="priority-icon high"></div>
                                <div class="priority-title">High Priority</div>
                                <div class="reminder-count">4</div>
                            </div>
                            <div class="reminder-list">
                                <div class="reminder-item high">
                                    <div class="reminder-client">
                                        Sarah Johnson 
                                        <span class="priority-score">91 pts</span>
                                    </div>
                                    <div class="reminder-text">No contact in 14 days - Last viewed $450K listing</div>
                                    <div class="reminder-scoring">
                                        <span class="score-detail">No contact 14d (+30) ‚Ä¢ Hot lead (+25) ‚Ä¢ High-value (√ó1.4)</span>
                                    </div>
                                    <div class="reminder-meta">
                                        <div class="reminder-time">14 days ago</div>
                                        <div class="reminder-property">üìç Main St</div>
                                    </div>
                                    <div class="reminder-actions">
                                        <button class="reminder-btn primary">Call</button>
                                        <button class="reminder-btn secondary">Email</button>
                                    </div>
                                </div>

                                <div class="reminder-item high">
                                    <div class="reminder-client">
                                        Jennifer Adams 
                                        <span class="priority-score">87 pts</span>
                                    </div>
                                    <div class="reminder-text">Pre-approval expires in 5 days</div>
                                    <div class="reminder-scoring">
                                        <span class="score-detail">Pre-approval expiring (+35) ‚Ä¢ VIP client (√ó1.5) ‚Ä¢ Hot lead (+25)</span>
                                    </div>
                                    <div class="reminder-meta">
                                        <div class="reminder-time">Expires Jun 5</div>
                                        <div class="reminder-property">üè¶ Pre-approved</div>
                                    </div>
                                    <div class="reminder-actions">
                                        <button class="reminder-btn primary">Contact</button>
                                        <button class="reminder-btn secondary">Extend</button>
                                    </div>
                                </div>

                                <div class="reminder-item high">
                                    <div class="reminder-client">
                                        David Thompson 
                                        <span class="priority-score">83 pts</span>
                                    </div>
                                    <div class="reminder-text">Closing deadline approaching - 3 days left</div>
                                    <div class="reminder-scoring">
                                        <span class="score-detail">Under contract deadline (+40) ‚Ä¢ No contact 5d (+15) ‚Ä¢ Repeat client (√ó1.2)</span>
                                    </div>
                                    <div class="reminder-meta">
                                        <div class="reminder-time">Due Jul 3</div>
                                        <div class="reminder-property">üìç Pine Blvd</div>
                                    </div>
                                    <div class="reminder-actions">
                                        <button class="reminder-btn primary">Call</button>
                                        <button class="reminder-btn secondary">Check</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Medium Priority -->
                        <div class="priority-column">
                            <div class="priority-header">
                                <div class="priority-icon medium"></div>
                                <div class="priority-title">Medium Priority</div>
                                <div class="reminder-count">6</div>
                            </div>
                            <div class="reminder-list">
                                <div class="reminder-item medium">
                                    <div class="reminder-client">Mike & Lisa Chen</div>
                                    <div class="reminder-text">Follow up on yesterday's showing</div>
                                    <div class="reminder-meta">
                                        <div class="reminder-time">1 day ago</div>
                                        <div class="reminder-property">üìç Oak Street</div>
                                    </div>
                                    <div class="reminder-actions">
                                        <button class="reminder-btn primary">Follow Up</button>
                                        <button class="reminder-btn secondary">Schedule</button>
                                    </div>
                                </div>

                                <div class="reminder-item medium">
                                    <div class="reminder-client">Amanda Wilson</div>
                                    <div class="reminder-text">Send updated market analysis</div>
                                    <div class="reminder-meta">
                                        <div class="reminder-time">3 days ago</div>
                                        <div class="reminder-property">üè¢ Downtown</div>
                                    </div>
                                    <div class="reminder-actions">
                                        <button class="reminder-btn primary">Send</button>
                                        <button class="reminder-btn secondary">Later</button>
                                    </div>
                                </div>

                                <div class="reminder-item medium">
                                    <div class="reminder-client">Robert Davis</div>
                                    <div class="reminder-text">Schedule home inspection</div>
                                    <div class="reminder-meta">
                                        <div class="reminder-time">Under contract</div>
                                        <div class="reminder-property">üìç Elm Avenue</div>
                                    </div>
                                    <div class="reminder-actions">
                                        <button class="reminder-btn primary">Schedule</button>
                                        <button class="reminder-btn secondary">Call</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Low Priority -->
                        <div class="priority-column">
                            <div class="priority-header">
                                <div class="priority-icon low"></div>
                                <div class="priority-title">Low Priority</div>
                                <div class="reminder-count">2</div>
                            </div>
                            <div class="reminder-list">
                                <div class="reminder-item low">
                                    <div class="reminder-client">Robert Martinez</div>
                                    <div class="reminder-text">Send monthly market newsletter</div>
                                    <div class="reminder-meta">
                                        <div class="reminder-time">Weekly check-in</div>
                                        <div class="reminder-property">üè¢ Subscriber</div>
                                    </div>
                                    <div class="reminder-actions">
                                        <button class="reminder-btn primary">Send</button>
                                        <button class="reminder-btn secondary">Skip</button>
                                    </div>
                                </div>

                                <div class="reminder-item low">
                                    <div class="reminder-client">Maria Rodriguez</div>
                                    <div class="reminder-text">Birthday follow-up opportunity</div>
                                    <div class="reminder-meta">
                                        <div class="reminder-time">Birthday today</div>
                                        <div class="reminder-property">üéÇ Past client</div>
                                    </div>
                                    <div class="reminder-actions">
                                        <button class="reminder-btn primary">Send Card</button>
                                        <button class="reminder-btn secondary">Call</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity Feed Tab -->
                <div class="tab-content" id="activity">
                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label class="filter-label">Activity Type</label>
                                <select class="filter-select">
                                    <option>All Activities</option>
                                    <option>Calls</option>
                                    <option>Emails</option>
                                    <option>Meetings</option>
                                    <option>Property Views</option>
                                    <option>Notes</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Time Range</label>
                                <select class="filter-select">
                                    <option>Last 7 days</option>
                                    <option>Last 30 days</option>
                                    <option>Last 90 days</option>
                                    <option>All time</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label